<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GH â€“ Dashboard</title>

  <style>
    body {
      margin: 0;
      background: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
    }

    /* =====================================================
       UNIVERSAL HEADER (unchanged)
    ===================================================== */
    .navbar {
      width: 100%;
      background: #111;
      border-bottom: 2px solid #fdff55;
      padding: 15px 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-sizing: border-box;
      z-index: 1000;
    }

    .navbar .brand {
      font-weight: 700;
      color: #fdff55;
      font-size: 20px;
    }

    .navbar .nav-links a {
      color: #fff;
      margin-left: 20px;
      text-decoration: none;
      font-weight: bold;
      position: relative;
      transition: 0.2s ease;
    }

    .navbar .nav-links a:hover {
      color: #fdff55;
      text-shadow: 0 0 10px #fdff55;
    }

    .navbar .nav-links a::after {
      content: "";
      height: 2px;
      width: 0%;
      background: #fdff55;
      display: block;
      transition: width 0.2s ease;
      margin-top: 3px;
    }

    .navbar .nav-links a:hover::after {
      width: 100%;
    }

    /* =====================================================
       DASHBOARD LAYOUT
    ===================================================== */
    .main-wrap {
      display: flex;
      height: calc(100vh - 70px);
    }

    /* CONTENT */
    .content {
      flex-grow: 1;
      padding: 25px;
      overflow-y: auto;
    }

    .card {
      background: #111;
      padding: 25px;
      border-radius: 12px;
      border: 2px solid #fdff55;
      margin-bottom: 25px;
      box-shadow: 0 0 16px #fdff5533;
    }

    .card h3 {
      margin-top: 0;
      color: #fdff55;
      text-shadow: 0 0 10px #fdff5522;
    }

    .announcement-item {
      margin-bottom: 18px;
      padding: 12px;
      border-left: 3px solid #00eaff;
      background: #151515;
      border-radius: 6px;
      box-shadow: 0 0 12px #00eaff22;
    }

    .announcement-title {
      font-weight: bold;
      color: #00eaff;
      text-shadow: 0 0 6px #00eaff55;
      font-size: 16px;
    }

    .announcement-message {
      margin-top: 5px;
      opacity: .9;
    }

    .announcement-timestamp {
      margin-top: 4px;
      font-size: 12px;
      opacity: .6;
    }

    textarea {
      background: #222;
      color: #fff;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #00eaff44;
      width: 100%;
    }

    textarea:focus {
      outline: none;
      border-color: #00eaff;
      box-shadow: 0 0 10px #00eaff;
    }

    .post-button {
      margin-top: 10px;
      background: #00eaff;
      border: none;
      padding: 10px 18px;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      color: #000;
      box-shadow: 0 0 12px #00eaff55;
      transition: 0.2s;
    }

    .post-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 18px #00eaff;
    }

    .post-box {
      padding: 12px;
      border-left: 3px solid #00eaff;
      margin-bottom: 15px;
      background: #151515;
      border-radius: 6px;
      box-shadow: 0 0 15px #00eaff22;
    }

    .post-author {
      color: #00eaff;
      font-weight: bold;
      margin-bottom: 4px;
    }

    .post-time {
      color: #bbb;
      font-size: 12px;
      margin-bottom: 8px;
    }
  </style>
</head>

<body>

<!-- UNIVERSAL HEADER -->
<div id="header"></div>
<script src="header.js"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="scripts/auth.js"></script>

<div class="main-wrap">

  <!-- UNIVERSAL DRAWER -->
  <div id="drawer"></div>
  <link rel="stylesheet" href="drawer.css">
  <script src="drawer.js"></script>

  <!-- CONTENT -->
  <div class="content">

    <!-- PAGE TITLE -->
    <h1 style="color:#fdff55; margin-top:0; margin-bottom:20px; 
               text-shadow:0 0 12px #fdff55aa; font-size:32px;">
      Dashboard
    </h1>

    <!-- ANNOUNCEMENTS -->
    <div class="card">
      <h3>Announcements</h3>
      <div id="announcementList">Loading announcements...</div>
    </div>

    <!-- GH DISCORD WIDGET -->
    <div class="card">
      <h3>GH Discord</h3>

      <iframe 
        src="https://discord.com/widget?id=843915204848517120&theme=dark"
        width="100%"
        height="420"
        allowtransparency="true"
        frameborder="0"
        sandbox="allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts"
        style="
          border-radius: 12px;
          border: 2px solid #00eaff;
          box-shadow: 0 0 20px #00eaff55;
        ">
      </iframe>
    </div>

    <!-- POSTS -->
    <div class="card">
      <h3>Posts</h3>

      <textarea id="postInput" placeholder="Share something with GH..."></textarea>

      <button onclick="createPost()" class="post-button">Post</button>

      <div id="postList" style="margin-top:20px;">Loading posts...</div>
    </div>

  </div>
</div>

<script>
auth.onAuthStateChanged(async user => {
  if (!user) return (location.href = "login.html");

  const token = await user.getIdTokenResult();

  db.collection("users").doc(user.uid).get().then(doc => {
    if (doc.exists && doc.data().name)
      userNameDisplay.textContent = doc.data().name;
    else
      userNameDisplay.textContent = user.email;
  });

  if (token.claims.admin)
    document.getElementById("adminLink").style.display = "block";
});

/* LOAD ANNOUNCEMENTS */
function loadAnnouncements() {
  db.collection("announcements")
    .orderBy("timestamp", "desc")
    .onSnapshot(snapshot => {
      const list = document.getElementById("announcementList");

      if (snapshot.empty) {
        list.innerHTML = "<p>No announcements yet.</p>";
        return;
      }

      list.innerHTML = "";

      snapshot.forEach(doc => {
        const data = doc.data();
        const ts =
          typeof data.timestamp === "number"
            ? new Date(data.timestamp).toLocaleString()
            : data.timestamp.toDate().toLocaleString();

        const wrap = document.createElement("div");
        wrap.classList.add("announcement-item");

        wrap.innerHTML = `
          <div class="announcement-title">${data.title}</div>
          <div class="announcement-message">${data.message}</div>
          <div class="announcement-timestamp">${ts}</div>
        `;

        list.appendChild(wrap);
      });
    });
}
loadAnnouncements();

/* CREATE POST */
async function createPost() {
  const text = document.getElementById("postInput").value.trim();
  if (!text) return alert("Post can't be empty.");

  const user = auth.currentUser;
  if (!user) return;

  const userDoc = await db.collection("users").doc(user.uid).get();
  const userName = userDoc.exists ? userDoc.data().name : user.email;

  await db.collection("posts").add({
    authorId: user.uid,
    authorName: userName,
    text: text,
    timestamp: Date.now()
  });

  document.getElementById("postInput").value = "";
}

/* LOAD POSTS */
function loadPosts() {
  db.collection("posts")
    .orderBy("timestamp", "desc")
    .onSnapshot(snapshot => {
      const container = document.getElementById("postList");

      if (snapshot.empty) {
        container.innerHTML = "<p>No posts yet.</p>";
        return;
      }

      container.innerHTML = "";

      snapshot.forEach(doc => {
        const p = doc.data();
        const ts = new Date(p.timestamp).toLocaleString();

        const div = document.createElement("div");
        div.className = "post-box";

        div.innerHTML = `
          <div class="post-author">${p.authorName}</div>
          <div class="post-time">${ts}</div>
          <div>${p.text}</div>
        `;

        container.appendChild(div);
      });
    });
}
loadPosts();

/* LOGOUT BUTTON */
document.getElementById("logout").addEventListener("click", () => {
  auth.signOut().then(() => (location.href = "login.html"));
});
</script>

</body>
</html>
